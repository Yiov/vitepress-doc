# 搭建图床

本文将介绍如何利用  [Cloudflare](https://www.cloudflare-cn.com/)  搭建免费图床，共有 2 种方式，我们将逐一说明。

 点击打开 [Cloudflare](https://www.cloudflare-cn.com/) 官网，如无账号，需先进行注册。

## 方式一：Cloudflare Pages + KV空间

利用 **Cloudflare Pages + KV空间** 搭建免费图床，此方式完全免费，不用担心因流量、访问次数等超额而产生费用。本站就是采用的这种方式，不过搭建有一定门槛（需搭 ti 子，不知道什么是 ti 子的请自行百度）。

### 准备工作

下载 **Telegram** ，安卓手机可以在应用市场安装 **出境易** APP，里面有 **Telegram**

### Fork 项目

登录 **GitHub** 账号，搜索 **Telegraph-Image** 或点击打开 [Telegraph-Image](https://github.com/cf-pages/Telegraph-Image) 页面，Fork 到自己的账号。

### 部署到 Cloudflare

登录 **Cloudflare** ，依次点击左侧菜单栏：**Compute (Workers) → Workers 和 Pages** ，进入页面后，点击 **创建** 按钮，之后点击 **Pages → 连接到 Git** ，如下图：

![创建应用程序1](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMZZ4CCK23mmZZnfcbJLXgaDkAkmrQAAlPBMRv3vQFUbhuhFniYvfUBAAMCAAN5AAM2BA.png)

然后，依次点击 **GitHub → GitHub账户 → 选择一个存储库 → 开始设置** ，如下图：

![创建应用程序2](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMaZ4CDEjmgN-djlO5aVrTrBmmLtxYAAlbBMRv3vQFU9QEhG2k7x1YBAAMCAAN5AAM2BA.png)

进入页面后，直接开始构建即可。

### 获取 TOKEN 和 ID

部署完成后，接下来返回 [Telegraph-Image](https://github.com/cf-pages/Telegraph-Image)，安装官方文档操作，获取 Telegram 的 **Bot_Token 和 Chat_ID** 。

如果你还没有Telegram账户，请先创建一个。接着，按照以下步骤操作以获取 BOT_TOKEN 和 CHAT_ID ：

1. 获取 Bot_Token

在Telegram中，向@BotFather发送命令/newbot，根据提示依次输入您的机器人名称和用户名。成功创建机器人后，您将会收到一个BOT_TOKEN，用于与Telegram API进行交互。

![获取Telegram API](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMbZ4CF3Cbgu5cmfsh0JUm984M8LlYAAlrBMRv3vQFUz1W06LOcJx8BAAMCAAN4AAM2BA.png)

2. 设置机器人为频道管理员

创建一个新的频道（Channel），进入该频道后，选择频道设置。将刚刚创建的机器人添加为频道管理员，这样机器人才能发送消息。

![设置管理员1](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMcZ4CGh5ZSCnGLVrnNu6YhB6oPSLYAAlvBMRv3vQFUd8A3Fs_G5coBAAMCAAN4AAM2BA.png)

![设置管理员2](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMdZ4CG0bJNLnGvspaUrtSdX08mgf8AAlzBMRv3vQFU1byrHtBKwRwBAAMCAAN5AAM2BA.png)

3. 获取Chat_ID

- 通过@VersaToolsBot获取您的频道ID。向该机器人发送消息，按照指示操作，最后您将得到CHAT_ID（即频道的ID）。
- 或者通过@GetTheirIDBot获取您的频道ID。向该机器人发送消息，按照指示操作，最后您将得到CHAT_ID（即频道的ID）。

![获取频道ID](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMeZ4CHKpTRNrtdKF84fNR_CfuX_iUAAl3BMRv3vQFUhs6BlWqmd2ABAAMCAAN4AAM2BA.png)

最后去 Cloudflare Pages 后台设置相关的环境变量（注：修改环境变量后，需要重新部署才能生效）

| 环境变量      |    示例值   | 说明     |
|    :----:    |    :----:   |  :----: |
| TG_Bot_Token | 123468:AAxxxGKrn5   | 从@BotFather获取的Telegram Bot Token。   |
| TG_Chat_ID   | -1234567        | 频道的ID，确保TG Bot是该频道或群组的管理员。   |

### 创建 KV 空间

登录 [Cloudflare](https://www.cloudflare-cn.com/) 官网，左侧菜单栏依次点击 **存储和数据库 → KV** ，然后在右侧页面点击 **创建** 按钮。 KV 空间名称填写：**img_url** ，创建完成会显示 **ID** 。

### 添加变量

选择之前构建的 **telegraph-image** ，依次点击 **设置 → 变量和机密** ，如下图：

![设置变量和机密](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMfZ4DBRNWXavf4y5gZ8HS32BKmBwwAAnDCMRv3vQFUC4bLdm2LvgoBAAMCAAN5AAM2BA.png)

点击 **添加** 按钮，分别添加 BASIC_USER 、 BASIC_PASS 、 TG_Bot_Token 、 
TG_Chat_ID 的值。如下图： 

![添加变量和机密的值](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMgZ4DGLLkePc0OiYNKYNDuic8l0toAAnrCMRv3vQFU1SqM2ZbzbDEBAAMCAAN4AAM2BA.png)

点击 **绑定** 按钮，绑定 KV空间 ，如下图：

![绑定KV空间](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMhZ4DHH17BvSOEZZAXtWdiPqa99QMAAoHCMRv3vQFUhc8JVq_vcFQBAAMCAAN5AAM2BA.png)

### 重新构建

添加变量和绑定 KV 空间结束后，我们需要重构项目，如下图：

![重新构建](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMiZ4DIX2cCfzA5xkFErCPJl5n1Z-kAAoPCMRv3vQFUowO3lc8EEJwBAAMCAAN3AAM2BA.png)

至此，自建图床可以使用了。

图床网址： https://IP（域名）

登录后台地址： https://IP（域名）/admin

## 方式二：Cloudflare R2 + PicGo

利用 Cloudflare R2 + PicGo 搭建免费图床，搭建过程较为简单，此方式为注册用户提供 10G 免费空间，且有流量、访问次数限制，超额使用将产生额外费用。不过也不用太过担心，正常来说，免费额度已完全够个人站长使用，即使超过使用额度，费用也相对国内存储空间便宜很多。

![R2免费额度](https://img.qxiansen.online/file/AgACAgUAAyEGAASG4H8TAAMjZ4DLenzmuKUJ3Yc_tESJyz7xRa4AAo7CMRv3vQFUL12mbdb-c7UBAAMCAAN4AAM2BA.png)

::: tip 提示
如果是第一次使用 Cloudflare ，除了注册账号以外，还需要添加一个付费计划，准备 1 张信用卡，或者国内的 PayPal 。以便在超额使用后进行扣费。
:::

### B站视频教程

可以参考B站UP主 **陶渊xiao明** 的视频教程，相对方式一的方法，此方式要简单很多，也比较容易操作。

<iframe 
style="width:100%; aspect-ratio:16/9; margin-top: 2em;" 
src="//player.bilibili.com/player.html?bvid=BV1eZCrY4E17" 
frameborder="0" 
allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
allowfullscreen>
</iframe>